<ion-header>
  <ion-toolbar>
    <button class="logo-small" ion-button menuToggle left (tap)="showCredits()">
      <img class="logo-small" src="assets/imgs/radar-logo.svg" alt="Logo" />
    </button>
    <button ion-button menuToggle right (tap)="openSettingsPage()">
      <ion-icon name="cog"></ion-icon>
    </button>
    <ion-title text-center>{{ title | async }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div
    class="size-dynamic"
    [class.hidden]="showCalendar"
    [@moveProgress]="showCalendar"
  >
    <task-progress
      *ngIf="tasksProgress | async"
      [progress]="tasksProgress | async"
      [forceComplete]="showCompleted"
      [noTasksToday]="(tasksProgress | async)?.numberOfTasks == 0"
    >
    </task-progress>
  </div>

  <div class="clinical-container" *ngIf="showMiscTasksButton | async">
    <ion-fab
      left
      bottom
      class="clinical-button"
      [class.clinical-button-bottom]="showCalendar"
    >
      <button ion-fab class="fab">
        <ion-icon name="add"></ion-icon>
      </button>
      <ion-fab-list side="top">
        <button
          *ngIf="hasClinicalTasks | async"
          class="clinical-icon"
          ion-fab
          (tap)="openClinicalTasksPage()"
        >
          <img src="assets/imgs/clinical.png" class="icon-clinical" />
        </button>
        <button
          *ngIf="hasOnDemandTasks | async"
          class="clinical-icon"
          ion-fab
          (tap)="openOnDemandTasksPage()"
        >
          <img src="{{ onDemandIcon | async }}" class="icon-clinical" />
        </button>
      </ion-fab-list>
    </ion-fab>
  </div>

  <div #tickerBar class="size-static">
    <ticker-bar
      [task]="nextTask"
      [isNow]="taskIsNow"
      [timeToNextMilli]="timeToNextTask"
      [showAffirmation]="showCompleted"
      [noTasksToday]="(tasksProgress | async)?.numberOfTasks == 0"
    ></ticker-bar>
  </div>

  <div class="size-static">
    <task-info
      *ngIf="nextTask"
      [task]="nextTask"
      [isNow]="taskIsNow"
      [progress]="tasksProgress | async"
      [expanded]="!showCalendar"
      (tap)="displayTaskCalendar()"
    ></task-info>
  </div>

  <div #taskCalendar class="taskCalendar" [@displayCalendar]="showCalendar">
    <task-calendar
      *ngIf="(sortedTasks | async)?.size"
      [show]="showCalendar"
      (task)="startQuestionnaire($event)"
      [tasks]="sortedTasks | async"
      [currentDate]="currentDate.getTime()"
      [isTaskNameShown]="isTaskNameShown"
    >
    </task-calendar>
  </div>

  <div class="size-static footer">
    <div *ngIf="getIsStartButtonShown() && (sortedTasks | async)?.size" padding>
      <button
        ion-button
        class="bt bt--full"
        round
        full
        (tap)="startQuestionnaire()"
      >
        {{ 'BTN_START' | translate }}
      </button>
    </div>
    <div
      *ngIf="
        getIsLoadingSpinnerShown() ||
        (!(sortedTasks | async)?.size && (tasksProgress | async)?.numberOfTasks)
      "
      class="spinner-center"
    >
      <ion-spinner name="dots"></ion-spinner>
    </div>
  </div>
</ion-content>

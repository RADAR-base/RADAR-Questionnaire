<ion-header>
  <ion-toolbar color="secondary">
    <ion-button
      class="logo-small"
      ion-button
      menuToggle
      slot="start"
      (click)="showCredits()"
    >
      <img class="logo-small" src="assets/imgs/radar-logo.svg" alt="Logo" />
    </ion-button>
    <ion-button ion-button menuToggle slot="end" (click)="openSettingsPage()">
      <ion-icon name="settings"></ion-icon>
    </ion-button>
    <ion-title class="ion-text-center">{{ title | async }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div
    class="size-dynamic"
    [class.hidden]="showCalendar"
    [@moveProgress]="showCalendar"
  >
    @if (tasksProgress | async) {
    <app-task-progress
      [progress]="tasksProgress | async"
      [forceComplete]="showCompleted"
      [noTasksToday]="(tasksProgress | async)?.numberOfTasks == 0"
    >
    </app-task-progress>
    }
  </div>

  <div class="bottom-components" [class.bottom-components-up]="showCalendar">
    @if (showMiscTasksButton | async) {
    <div class="clinical-container">
      <ion-fab
        left
        bottom
        class="clinical-button"
        [class.clinical-button-bottom]="showCalendar"
      >
        <ion-fab-button ion-fab class="fab">
          <ion-icon name="add"></ion-icon>
        </ion-fab-button>
        <ion-fab-list side="top">
          @if (hasClinicalTasks | async) {
            <ion-fab-button
            class="clinical-icon"
            ion-fab
            (click)="openClinicalTasksPage()"
          >
            <img src="assets/imgs/clinical.png" class="icon-clinical" />
          </ion-fab-button>
          }
          @if (hasOnDemandTasks | async) {
            <ion-fab-button
            class="clinical-icon"
            ion-fab
            (click)="openOnDemandTasksPage()"
          >
            <img src="{{ onDemandIcon | async }}" class="icon-clinical" />
          </ion-fab-button>
          }
        </ion-fab-list>
      </ion-fab>
    </div>
    }

    <div #tickerBar class="size-static">
      <app-ticker-bar
        [task]="nextTask"
        [isNow]="taskIsNow"
        [timeToNextMilli]="timeToNextTask"
        [showAffirmation]="showCompleted"
        [noTasksToday]="(tasksProgress | async)?.numberOfTasks == 0"
      ></app-ticker-bar>
    </div>

    <div class="size-static">
      @if (nextTask && (isTaskInfoShown | async)) {
      <app-task-info
        [task]="nextTask"
        [isNow]="taskIsNow"
        [progress]="tasksProgress | async"
        [expanded]="!showCalendar"
        (click)="displayTaskCalendar()"
      ></app-task-info>
      }
    </div>
    <div #taskCalendar class="taskCalendar" [@displayCalendar]="showCalendar">
      @if ((sortedTasks | async)?.size &&
      (isTaskCalendarTaskNameShown | async) !== null) {
      <app-task-calendar
        [show]="showCalendar"
        (task)="startQuestionnaire($event)"
        [tasks]="sortedTasks | async"
        [currentDate]="currentDate"
        [isTaskNameShown]="isTaskCalendarTaskNameShown | async"
      >
      </app-task-calendar>
      }
    </div>

    <div class="size-static footer">
      @if (getIsStartButtonShown() && (sortedTasks | async)?.size) {
        <div
        class="ion-padding"
      >
        <ion-button
          ion-button
          class="bt bt--full"
          round
          full
          (click)="startQuestionnaire(null)"
        >
          {{ 'BTN_START' | translate }}
        </ion-button>
      </div>
      }
      @if (getIsLoadingSpinnerShown() ||
      (!(sortedTasks | async)?.size &&
        (tasksProgress | async)?.numberOfTasks)) {
        <div
        class="spinner-center"
      >
        <ion-spinner name="dots"></ion-spinner>
      </div>
      }
    </div>
  </div>
</ion-content>

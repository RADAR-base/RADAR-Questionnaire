<ion-content [scrollY]="false" class="ion-padding-top">
  <div class="wrapper">
    <div class="slide-flex">
      <swiper-container #swiper (swiperreachend)="onSlideFinish()">
        @if (showIntroductionScreen) {
          <swiper-slide class="center">
            <app-introduction
              [title]="questionTitle"
              [introduction]="introduction"
              (start)="handleIntro($event)"
            ></app-introduction>
          </swiper-slide>
        }
        <ng-container>
          @for (item of groupedQuestions | keyvalue : asIsOrder; let i = $index; track item.key) {
            <swiper-slide>
              @for (question of item.value; track question; let j = $index) {
                <div
                  class="q-container"
                >
                  @if (i >= currentQuestionGroupId - 10 &&
                  i <= currentQuestionGroupId + 10 &&
                  currentQuestionIndices.includes(j)) {
                    <app-question
                      [question]="question"
                      [questionIndex]="i"
                      [task]="task"
                      [currentIndex]="currentQuestionGroupId"
                      [isSectionHeaderHidden]="j != currentQuestionIndices[0]"
                      [isMatrix]="item.value.length > 1"
                      (answer)="onAnswer($event)"
                      (nextAction)="nextAction($event)"
                    ></app-question>
                  }
                </div>
              }
            </swiper-slide>
          }
        </ng-container>
        <swiper-slide class="center">
          @if (showFinishScreen && !showFinishAndLaunchScreen) {
            <app-finish
              [content]="endText"
              [isLastTask]="isLastTask"
              [requiresInClinicCompletion]="requiresInClinicCompletion"
              [taskType]="taskType"
              [isShown]="showFinishScreen"
              [progressCount]="progressCount$ | async"
              [questions]="questions"
              [task]="task"
              (exit)="handleFinish()"
            ></app-finish>
          }
          @if (showFinishScreen && showFinishAndLaunchScreen) {
            <app-finish-and-launch
              [externalApp]="externalApp"
              [task]="task"
              [content]="endText"
              [isLastTask]="isLastTask"
              [requiresInClinicCompletion]="requiresInClinicCompletion"
              [taskType]="taskType"
              [showDoneButton]="showDoneButton"
              [isShown]="showFinishScreen"
              [progressCount]="progressCount$ | async"
              (exit)="handleFinish()"
            ></app-finish-and-launch>
          }
        </swiper-slide>
      </swiper-container>
    </div>
  </div>
</ion-content>

<ion-footer [class.hidden]="showIntroductionScreen || showFinishScreen">
  <app-toolbar
    (next)="nextQuestion()"
    (previous)="previousQuestion()"
    (close)="exitQuestionnaire()"
    (finish)="navigateToFinishPage()"
    (tappedDisabledButton)="showDisabledButtonAlert()"
    [isLeftButtonDisabled]="isLeftButtonDisabled"
    [isRightButtonDisabled]="isRightButtonDisabled"
    [currentQuestionId]="currentQuestionGroupId"
    [totalQuestions]="groupedQuestions?.size"
    [isProgressCountShown]="showProgressCount | async"
  ></app-toolbar>
</ion-footer>
